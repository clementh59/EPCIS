{
	"$id": "https://ns.gs1.org/epcis-schema.json",

	"definitions": {
		"aggregationEvent": {
			"allOf": [{
					"$ref": "#/definitions/event"
				},
				{
					"type": "object",
					"properties": {
						"isA": {
							"type": "string",
							"pattern": "^AggregationEvent$"
						},
						"parentID": {
							"$ref": "#/definitions/uri"
						},
						"childEPCs": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/uri"
							}
						},
						"childQuantityList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/quantityElement"
							}
						},
						"action": {
							"$ref": "#/definitions/action"
						},
						"bizStep": {
							"$ref": "#/definitions/uri"
						},
						"disposition": {
							"$ref": "#/definitions/uri"
						},
						"persistentDisposition": {
							"$ref": "#/definitions/persistentDisposition"
						},
						"readPoint": {
							"$ref": "#/definitions/readPoint"
						},
						"bizLocation": {
							"$ref": "#/definitions/bizLocation"
						},
						"bizTransactionList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/bizTransaction"
							}
						},
						"sourceList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/source"
							}
						},
						"destinationList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/destination"
							}
						},
						"sensorElementList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/sensorElement"
							}
						}
					},
					"required": ["isA", "action"]
				},
				{
					"anyOf": [{
							"properties": {
								"childEPCs": {
									"minItems": 1
								}
							},
							"required": ["childEPCs"]
						},
						{
							"properties": {
								"childQuantityList": {
									"minItems": 1
								}
							},
							"required": ["childQuantityList"]
						},
						{
							"properties": {
								"action": {
									"pattern": "^DELETE$"
								}
							}
						}
					]
				}
			]
		},
		"associationEvent": {
			"allOf": [{
					"$ref": "#/definitions/event"
				},
				{
					"type": "object",
					"properties": {
						"isA": {
							"type": "string",
							"pattern": "^AssociationEvent$"
						},
						"parentID": {
							"$ref": "#/definitions/uri"
						},
						"childEPCs": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/uri"
							}
						},
						"childQuantityList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/quantityElement"
							}
						},
						"action": {
							"$ref": "#/definitions/action"
						},
						"bizStep": {
							"$ref": "#/definitions/uri"
						},
						"disposition": {
							"$ref": "#/definitions/uri"
						},
						"persistentDisposition": {
							"$ref": "#/definitions/persistentDisposition"
						},
						"readPoint": {
							"$ref": "#/definitions/readPoint"
						},
						"bizLocation": {
							"$ref": "#/definitions/bizLocation"
						},
						"bizTransactionList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/bizTransaction"
							}
						},
						"sourceList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/source"
							}
						},
						"destinationList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/destination"
							}
						},
						"sensorElementList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/sensorElement"
							}
						}
					},
					"required": ["isA", "action", "parentID"]
				},
				{
					"anyOf": [{
							"properties": {
								"childEPCs": {
									"minItems": 1
								}
							},
							"required": ["childEPCs"]
						},
						{
							"properties": {
								"childQuantityList": {
									"minItems": 1
								}
							},
							"required": ["childQuantityList"]
						},
						{
							"properties": {
								"action": {
									"pattern": "^DELETE$"
								}
							}
						}
					]
				}
			]
		},
		"transactionEvent": {
			"allOf": [{
					"$ref": "#/definitions/event"
				},
				{
					"type": "object",
					"properties": {
						"isA": {
							"type": "string",
							"pattern": "^TransactionEvent$"
						},
						"bizTransactionList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/bizTransaction"
							},
							"minItems": 1
						},
						"parentID": {
							"$ref": "#/definitions/uri"
						},
						"epcList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/uri"
							}
						},
						"quantityList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/quantityElement"
							}
						},
						"action": {
							"$ref": "#/definitions/action"
						},
						"bizStep": {
							"$ref": "#/definitions/uri"
						},
						"disposition": {
							"$ref": "#/definitions/uri"
						},
						"persistentDisposition": {
							"$ref": "#/definitions/persistentDisposition"
						},
						"readPoint": {
							"$ref": "#/definitions/readPoint"
						},
						"bizLocation": {
							"$ref": "#/definitions/bizLocation"
						},
						"sourceList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/source"
							}
						},
						"destinationList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/destination"
							}
						},
						"sensorElementList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/sensorElement"
							}
						}
					},
					"required": ["isA", "bizTransactionList", "action"]
				},
				{
					"anyOf": [{
							"properties": {
								"epcList": {
									"minItems": 0
								}
							},
							"required": ["epcList"]
						},
						{
							"properties": {
								"quantityList": {
									"minItems": 1
								}
							},
							"required": ["quantityList"]
						},
						{
							"properties": {
								"action": {
									"pattern": "^DELETE$"
								}
							}
						}
					]
				}
			]
		},
		"transformationEvent": {
			"allOf": [{
					"$ref": "#/definitions/event"
				},
				{
					"type": "object",
					"properties": {
						"isA": {
							"type": "string",
							"pattern": "^TransformationEvent$"
						},
						"inputEPCList": {
							"$ref": "#/definitions/epcList"
						},
						"inputQuantityList": {
							"$ref": "#/definitions/quantityList"
						},
						"outputEPCList": {
							"$ref": "#/definitions/epcList"
						},
						"outputQuantityList": {
							"$ref": "#/definitions/quantityList"
						},
						"transformationID": {
							"$ref": "#/definitions/uri"
						},
						"bizStep": {
							"$ref": "#/definitions/uri"
						},
						"disposition": {
							"$ref": "#/definitions/uri"
						},
						"persistentDisposition": {
							"$ref": "#/definitions/persistentDisposition"
						},
						"readPoint": {
							"$ref": "#/definitions/readPoint"
						},
						"bizLocation": {
							"$ref": "#/definitions/bizLocation"
						},
						"bizTransactionList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/bizTransaction"
							}
						},
						"sourceList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/source"
							}
						},
						"destinationList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/destination"
							}
						},
						"sensorElementList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/sensorElement"
							}
						},
						"ilmd": {
							"$ref": "#/definitions/ilmd"
						}
					},
					"required": ["isA"]
				},
				{
					"anyOf": [{
							"allOf": [{
									"anyOf": [{
											"properties": {
												"inputEPCList": {
													"minItems": 1
												}
											},
											"required": ["inputEPCList"]
										},
										{
											"properties": {
												"inputQuantityList": {
													"minItems": 1
												}
											},
											"required": ["inputQuantityList"]
										}
									]
								},
								{
									"anyOf": [{
											"properties": {
												"outputEPCList": {
													"minItems": 1
												}
											},
											"required": ["outputEPCList"]
										},
										{
											"properties": {
												"outputQuantityList": {
													"minItems": 1
												}
											},
											"required": ["outputQuantityList"]
										}
									]
								}
							]
						},
						{
							"anyOf": [{
									"properties": {
										"inputEPCList": {
											"minItems": 1
										}
									},
									"required": ["inputEPCList"]
								},
								{
									"properties": {
										"inputQuantityList": {
											"minItems": 1
										}
									},
									"required": ["inputQuantityList"]
								},
								{
									"properties": {
										"outputEPCList": {
											"minItems": 1
										}
									},
									"required": ["outputEPCList"]
								},
								{
									"properties": {
										"outputQuantityList": {
											"minItems": 1
										}
									},
									"required": ["outputQuantityList"]
								}
							],
							"required": ["transformationID"]
						}
					]
				}
			]
		},
		"onlyValidEvent": {
			"required": ["isA"],
			"allOf": [{
					"if": {
						"properties": {
							"isA": {
								"const": "ObjectEvent"
							}
						}
					},
					"then": {
						"$ref": "#/definitions/objectEvent"
					}
				},
				{
					"if": {
						"properties": {
							"isA": {
								"const": "AggregationEvent"
							}
						}
					},
					"then": {
						"$ref": "#/definitions/aggregationEvent"
					}
				},
				{
					"if": {
						"properties": {
							"isA": {
								"const": "TransactionEvent"
							}
						}
					},
					"then": {
						"$ref": "#/definitions/transactionEvent"
					}
				},
				{
					"if": {
						"properties": {
							"isA": {
								"const": "TransformationEvent"
							}
						}
					},
					"then": {
						"$ref": "#/definitions/transformationEvent"
					}
				},
				{
					"if": {
						"properties": {
							"isA": {
								"const": "AssociationEvent"
							}
						}
					},
					"then": {
						"$ref": "#/definitions/associationEvent"
					}
				}
			],
			"properties": {
				"isA": {
					"type": "string",
					"enum": [
						"AssociationEvent",
						"ObjectEvent",
						"AggregationEvent",
						"TransactionEvent",
						"TransformationEvent"
					]
				}
			}
		},
		"vocabulary": {
			"type": "object",
			"properties": {
				"type": {
					"$ref": "#/definitions/uri"
				},
				"vocabularyElementList": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/vocabularyElement"
					}
				}
			},
			"required": ["type"]
		},
		"vocabularyElement": {
			"type": "object",
			"properties": {
				"id": {
					"$ref": "#/definitions/uri"
				},
				"attributes": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/attribute"
					}
				},
				"children": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/uri"
					}
				}
			},
			"required": ["id"]
		},
		"attribute": {
			"type": "object",
			"properties": {
				"id": {
					"$ref": "#/definitions/uri"
				},
				"attribute": {
					"anyOf": [{
							"type": "number"
						},
						{
							"type": "string"
						},
						{
							"type": "object"
						}
                    ]
				}
			},
			"required": ["id"]
		},
		"eventList": {
			"type": "array",
			"items": {
				"anyOf": [{
					"$ref": "#/definitions/onlyValidEvent"
				}]
			}
		},
		"vocabularyList": {
			"type": "array",
			"items": {
				"$ref": "#/definitions/vocabulary"
			}
		},
		"resultsBody": {
			"type": "object",
			"properties": {
				"eventList": {
					"$ref": "#/definitions/eventList"
				},
				"vocabularyList": {
					"$ref": "#/definitions/vocabularyList"
				}
			},
			"required": ["eventList"]
		},

		"queryResults": {
			"type": "object",
			"properties": {
				"queryName": {
					"type": "string"
				},
				"subscriptionID": {
					"type": "string"
				},
				"resultsBody": {
					"$ref": "#/definitions/resultsBody"
				}
			},
			"required": ["resultsBody"]
		},
		"epcisQueryDocumentBody": {
			"type": "object",
			"properties": {
				"queryResults": {
					"$ref": "#/definitions/queryResults"
				}
			},
			"required": ["queryResults"]
		},
		"epcisHeader": {
			"type": "object",
			"properties": {
				"epcisMasterData": {
					"type": "object",
					"properties": {
						"vocabularyList": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/vocabulary"
							}
						}
					}
				}
			}



		},
		"epcisDocument": {
			"type": "object",
			"properties": {
				"isA": {
					"type": "string",
					"const": "EPCISDocument"
				},
				"@context": {
					"anyOf": [
						{
							"type": "string",
							"format": "uri"
						},
						{
							"type": "object"
						},
						{
							"type": "array",
							"uniqueItems": true,
							"items": {
								"anyOf": [{
										"type": "string",
										"format": "uri"
									},
									{
										"type": "object"
									}
								]
							}
						}
					]
				},
				"schemaVersion": {
					"type": "string"
				},
				"creationDate": {
					"type": "string",
					"format": "date-time"
				},
				"epcisHeader": {
					"$ref": "#/definitions/epcisHeader"
				},
				"epcisBody": {
					"type": "object",
					"properties": {
						"eventList": {
							"$ref": "#/definitions/eventList"
						}					},
					"required": ["eventList"]
				}
			},
			"required": ["schemaVersion", "creationDate", "epcisBody"]
		},
		"epcisQueryDocument": {
			"type": "object",
			"properties": {
				"isA": {
					"type": "string",
					"const": "EPCISQueryDocument"
				},
				"@context": {
					"anyOf": [
						{
							"type": "string",
							"format": "uri"
						},
						{
							"format": "object"
						},
						{
							"type": "array",
							"uniqueItems": true,
							"items": {
								"anyOf": [{
										"type": "string",
										"format": "uri"
									},
									{
										"type": "object"
									}
								]
							}
						}
					]
				},
				"epcisBody": {
					"$ref": "#/definitions/epcisQueryDocumentBody"
				}
			},
			"required": ["epcisBody"]
		}
	},

	"required": ["isA"],
	"properties": {
		"isA": {
			"type": "string",
			"pattern": "^EPCISDocument|EPCISQueryDocument$"
		}
	},
	"allOf": [{
			"if": {
				"properties": {
					"isA": {
						"const": "EPCISDocument"
					}
				}
			},
			"then": {
				"$ref": "#/definitions/epcisDocument"
			}
		},
		{
			"if": {
				"properties": {
					"isA": {
						"const": "EPCISQueryDocument"
					}
				}
			},
			"then": {
				"$ref": "#/definitions/epcisQueryDocument"
			}
		}


	]


}
